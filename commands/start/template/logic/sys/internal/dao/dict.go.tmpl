package dao

import (
	"context"
	"reflect"

	"github.com/fengjx/daox"
	"github.com/fengjx/daox/sqlbuilder/ql"

	"{{.gomod}}/integration/db"
	"{{.gomod}}/logic/sys/internal/data/entity"
	"{{.gomod}}/logic/sys/internal/data/enum"
	"{{.gomod}}/logic/sys/internal/data/meta"
)

var SysDictDao *sysDictDao

func init() {
	SysDictDao = newSysDictDao()
}

type sysDictDao struct {
	*daox.Dao
}

func newSysDictDao() *sysDictDao {
	inst := &sysDictDao{}
	inst.Dao = daox.NewDAO(
		db.GetDefaultDB(),
		"sys_dict",
		"id",
		reflect.TypeOf(&entity.SysDict{}),
	)
	return inst
}

// ListAll 查询所有生效数据字典
func (dao sysDictDao) ListAll(ctx context.Context) ([]*entity.SysDict, error) {
	selector := dao.Selector().Where(ql.C().And(
		ql.Col(meta.SysUserMeta.Status).EQ(enum.DictStatusNormal),
	))
	var list []*entity.SysDict
	err := dao.SelectContext(ctx, &list, selector)
	if err != nil {
		return nil, err
	}
	return list, nil
}
